<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNavDropdown"
      aria-controls="navbarNavDropdown"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <div class="form-group">
            <div class="filter-header">
              <h2 style="font-family: 'Quicksand', sans-serif">Filtros</h2>
              <button *ngIf="hasActiveFilters()" type="button" class="clear-filters-btn" (click)="clearAllFilters()" matTooltip="Limpiar todos los filtros">
                <mat-icon>filter_list_off</mat-icon>
              </button>
            </div>
            <label for="supplier">Proveedores</label>
            <select class="form-control" id="supplier" (change)="onSupplierChange($event)" [(ngModel)]="selectedSupplierCuit" name="supplier">
              <option value="">Todos</option>
              <option *ngFor="let supplier of suppliers" [value]="supplier.cuit">{{ supplier.cuit + ' ' + supplier.businessName }}</option>
            </select>
          </div>
        </li>
        <li class="nav-item">
          <div class="form-group">
            <label for="category">Categorías</label>
            <select class="form-control" id="category" (change)="onCategoryChange($event)" [(ngModel)]="selectedCategoryName" name="category">
              <option value="">Todas</option>
              <option *ngFor="let category of categories" [value]="category.name">{{ category.name }}</option>
            </select>
          </div>
        </li>
        <li class="nav-item">
          <div class="form-group">
            <label for="status">Estado</label>
            <select class="form-control" id="status" (change)="onStatusChange($event)" [(ngModel)]="selectedStatus" name="status">
              <option value="">Todos</option>
              <option value="true">Activo</option>
              <option value="false">Inactivo</option>
            </select>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Mensaje cuando no hay productos -->
<div *ngIf="products.length === 0" class="no-products-message">
  <mat-icon>inventory_2</mat-icon>
  <h3>No hay productos disponibles</h3>
  <p *ngIf="hasActiveFilters()">No se encontraron productos con los filtros aplicados. Intenta ajustar los criterios de búsqueda.</p>
  <p *ngIf="!hasActiveFilters()">No hay productos cargados en el sistema en este momento.</p>
</div>

<!-- Contenedor de productos cuando hay productos disponibles -->
<div *ngIf="products.length > 0" class="products-container">
  <div class="product-card" *ngFor="let product of products">
    <div class="card">
      <!-- Botones de acción -->
      <div class="card-actions">
        <ng-container *ngIf="product.stock < product.minimumStock && product.isActive">
          <button mat-icon-button (click)="showLowStockAlert(product)" *ngIf="!product.mailSent">
            <mat-icon class="warning">warning</mat-icon>
          </button>
          <div *ngIf="product.mailSent" class="sent">
            <mat-icon>check_circle</mat-icon>
            <span>Pedido enviado</span>
          </div>
        </ng-container>

        <!-- Botones -->
        <button mat-icon-button *ngIf="!product.editing && product.isActive" class="yellow-btn" (click)="edit(product)">
          <mat-icon>create</mat-icon>
        </button>

        <button mat-icon-button *ngIf="!product.editing && product.isActive" color="warn" (click)="delete(product.id)">
          <mat-icon>delete</mat-icon>
        </button>

        <button mat-icon-button *ngIf="!product.editing && !product.isActive" color="primary" (click)="reactivate(product)">
          <mat-icon>restore</mat-icon>
        </button>

        <button mat-icon-button *ngIf="product.editing" color="primary" (click)="save(product)">
          <mat-icon>save_alt</mat-icon>
        </button>

        <button mat-icon-button *ngIf="product.editing" color="warn" (click)="cancelEdit(product)">
          <mat-icon>cancel</mat-icon>
        </button>
      </div>

      <!-- Imagen -->
      <img *ngIf="!product.editing" class="card-img" [src]="getImageUrl(product.image)" alt="{{ product.name }}" />

      <!-- Info -->
      <div class="card-body" *ngIf="!product.editing">
        <h3>{{ product.name }}</h3>
        <p class="desc">{{ product.description }}</p>
        <p><strong>Precio:</strong> {{ product.price }}</p>
        <p><strong>Stock:</strong> {{ product.stock }} / {{ product.minimumStock }}</p>
      </div>

      <!-- Edición -->
      <div class="edit-mode" *ngIf="product.editing">
        <!-- Imagen en modo edición -->
        <div class="form-group">
          <label>Imagen</label>
          <input type="file" class="form-control" [id]="'image-' + product.id" (change)="onImageSelected($event, product)" accept="image/*" />

          <div class="image-preview">
            <img *ngIf="product.imagePreviewUrl" [src]="product.imagePreviewUrl" alt="Nueva imagen" />
            <img *ngIf="!product.imagePreviewUrl" [src]="getImageUrl(product.image)" alt="{{ product.name }}" class="faded" />
          </div>
        </div>

        <!-- Nombre -->
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" class="form-control" [(ngModel)]="product.editName" />
        </div>

        <!-- Descripción -->
        <div class="form-group">
          <label>Descripción</label>
          <textarea class="form-control" [(ngModel)]="product.editDescription"></textarea>
        </div>

        <!-- Precio -->
        <div class="form-group">
          <label>Precio</label>
          <input type="text" class="form-control" [(ngModel)]="product.editPrice" />
        </div>

        <!-- Stock -->
        <div class="form-group">
          <label>Stock</label>
          <input type="number" class="form-control" [(ngModel)]="product.editStock" />
        </div>

        <!-- Stock mínimo -->
        <div class="form-group">
          <label>Stock mínimo</label>
          <input type="number" class="form-control" [(ngModel)]="product.editMinimumStock" />
        </div>
      </div>
    </div>
  </div>
</div>
