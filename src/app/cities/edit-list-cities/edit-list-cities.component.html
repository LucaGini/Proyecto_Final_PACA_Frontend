<div class="cities-container">
  <div class="city-card" *ngFor="let city of cities">
    <div class="card">
      <!-- Acciones -->
      <div class="card-actions">
        <button mat-icon-button *ngIf="!city.editing" class="yellow-btn" (click)="edit(city)">
          <mat-icon>create</mat-icon>
        </button>
        <button mat-icon-button *ngIf="!city.editing" color="warn" (click)="delete(city)">
          <mat-icon>delete</mat-icon>
        </button>
        <button mat-icon-button *ngIf="city.editing" color="primary" (click)="save(city)"
          [disabled]="!city.editName || !city.editPostCode || !city.editSurcharge">
          <mat-icon>save_alt</mat-icon>
        </button>
        <button mat-icon-button *ngIf="city.editing" color="warn" (click)="cancelEdit(city)">
          <mat-icon>cancel</mat-icon>
        </button>
      </div>

      <div class="card-body">
        <!-- Editable -->
        <div *ngIf="city.editing" class="edit-mode">
          <div class="form-group">
            <label>Nombre</label>
            <textarea class="form-control" [(ngModel)]="city.editName" name="editName" required
              #editNameInput="ngModel" [ngClass]="{ 'is-invalid': editNameInput.invalid && editNameInput.touched }"></textarea>
            <small *ngIf="editNameInput.invalid && editNameInput.touched" class="error-msg">El nombre es obligatorio.</small>
          </div>

          <div class="form-group">
            <label>Código postal</label>
            <input type="text" class="form-control" [(ngModel)]="city.editPostCode" name="editPostCode"
              pattern="[A-Za-z0-9]{8,10}" required minlength="8" maxlength="10"
              #editPostCodeInput="ngModel" [ngClass]="{ 'is-invalid': editPostCodeInput.invalid && editPostCodeInput.touched }" />
            <div *ngIf="editPostCodeInput.invalid && editPostCodeInput.touched" class="text-danger">
              <small *ngIf="editPostCodeInput.errors?.['required']">El código postal es obligatorio.</small>
              <small *ngIf="editPostCodeInput.errors?.['minlength']">Debe tener entre 8 y 10 caracteres.</small>
              <small *ngIf="editPostCodeInput.errors?.['maxlength']">Debe tener entre 8 y 10 caracteres.</small>
              <small *ngIf="editPostCodeInput.errors?.['pattern']">Solo letras y números.</small>
            </div>
          </div>

          <div class="form-group">
            <label>Recargo</label>
            <input type="number" class="form-control" [(ngModel)]="city.editSurcharge" name="editSurcharge" required
              #editSurchargeInput="ngModel" [ngClass]="{ 'is-invalid': editSurchargeInput.invalid && editSurchargeInput.touched }" />
            <small *ngIf="editSurchargeInput.invalid && editSurchargeInput.touched" class="error-msg">El recargo es obligatorio.</small>
          </div>
        </div>

        <!-- No editable -->
        <div *ngIf="!city.editing">
          <h3 class="card-text">Nombre</h3>
          <p class="truncate">{{ city.name }}</p>

          <h3 class="card-text">Código postal</h3>
          <p class="truncate">{{ city.postCode }}</p>

          <h3 class="card-text">Recargo</h3>
          <p>{{ city.surcharge }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
